#!/usr/bin/env node

var twitterApi = require("../lib/twitter.js"),
	request = require("request");

var arguments = process.argv.slice(2);

var init = (arguments[0] == 'init');

if(init) {
		twitterApi.getAuthURL(function (url, auth_token) {
			console.log("Go to this URL and get the PIN: " + url);
			var PIN = "";
			console.log("Enter the PIN here: ");
			process.stdin.resume();
			process.stdin.setEncoding("utf8");
			process.stdin.once("data", function (chunk) {
				PIN = chunk.toString().trim();
				token = twitterApi.getAccessToken(auth_token, PIN, function (params) {
					console.log("Here are your security tokens: ");
					console.log("Token: " + params.oauth_token);
					console.log("Secret Token: " + params.oauth_token_secret);
					console.log("Data saved, you can now post!");
					process.exit();
				});
			});
		});
} else {
	var destination = arguments[0];
	var message = arguments[1];

	if(destination != undefined && message != undefined) {
		twitterApi.sendDM(destination, message);
	} else {
		console.log("Wrong parameters, make sure you're using the app correctly:");
		console.log('$ tdm [destination_screen_name] "[Message to send quoted]"');
		console.log("");
	}

}
