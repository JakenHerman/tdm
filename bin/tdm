#!/usr/bin/env node

var twitterApi = require("../lib/twitter.js"),
	ViewHandler = require("../lib/viewHandler"),
	CommandFactory = require("../lib/commandFactory");

var arguments = process.argv.slice(2);

var init = (arguments[0] == 'init');

if(init) {
		twitterApi.getAuthURL(function (url, auth_token) {
			console.log("Go to this URL and get the PIN: " + url);
			var PIN = "";
			console.log("Enter the PIN here: ");
			process.stdin.resume();
			process.stdin.setEncoding("utf8");
			process.stdin.once("data", function (chunk) {
				PIN = chunk.toString().trim();
				token = twitterApi.getAccessToken(auth_token, PIN, function (params) {
					console.log("Here are your security tokens: ");
					console.log("Token: " + params.oauth_token);
					console.log("Secret Token: " + params.oauth_token_secret);
					console.log("Data saved, you can now post!");
					process.exit();
				});
			});
		});
} else {
	var command = CommandFactory.getCommand(arguments);
	command.run(function(err, result) {
		ViewHandler.show(err, command, result);
	});
}
